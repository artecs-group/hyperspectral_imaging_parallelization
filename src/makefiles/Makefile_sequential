DEBUG = no

# Default compiler and flags
CC = icpx
CFLAGS = -I"${MKLROOT}/include" -qmkl -DMKL_ILP64 -DSEQUENTIAL -O3
CLINK =  -Wl,--start-group ${MKLROOT}/lib/intel64/libmkl_intel_lp64.a ${MKLROOT}/lib/intel64/libmkl_sequential.a ${MKLROOT}/lib/intel64/libmkl_core.a -Wl,--end-group -lpthread -lm -ldl

# Debug Flags
ifeq ($(DEBUG),yes)
 CFLAGS += -g
endif

main_sequential: ./VCA/sequential/vca.o ./VD/sequential/vd.o ./ISRA/sequential/isra.o main.o
	$(CC) $(CFLAGS) $(CLINK) main.o ./VD/sequential/vd.o ./VCA/sequential/vca.o ./ISRA/sequential/isra.o -o main_sequential

main.o: ./VD/sequential/vd.o ./VCA/sequential/vca.o
	$(CC) $(CFLAGS) main.cpp -c -o main.o

./VD/sequential/vd.o:
	$(CC) $(CFLAGS) ./VD/sequential/vd.cpp -c -o ./VD/sequential/vd.o

./VCA/sequential/vca.o:
	$(CC) $(CFLAGS) ./VCA/sequential/vca.cpp -c -o ./VCA/sequential/vca.o

./ISRA/sequential/isra.o:
	$(CC) $(CFLAGS) ./ISRA/sequential/isra.cpp -c -o ./ISRA/sequential/isra.o

run: main_sequential
	./main_sequential ../data/Cuprite 5 0 5

.PHONY: clean
clean:
	rm -f main_sequential \
	*.o \
	./VD/sequential/*.o \
	./VCA/sequential/*.o \
	./ISRA/sequential/*.o